🔧 DIAGNÓSTICO Y ARREGLO DE MONGODB ATLAS
==========================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PASO 1: Verificar conectividad de red
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1.1: Probar resolución DNS del cluster...
[0;32m✅ DNS resuelve correctamente[0m
Address:	fe80::1c3c:78ff:fe4e:3964%14#53

1.2: Probar conectividad TCP al puerto 27017...
[1;33m⚠️ Puerto 27017 no responde directamente[0m
   (Esto es normal para MongoDB Atlas con SRV)

1.3: Verificar certificados SSL...
[1;33m⚠️ No se pudo verificar SSL (puede ser normal)[0m

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PASO 2: Probar conexión con MongoDB Shell
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2.1: Intentando conectar con mongosh...
Comando: mongosh 'mongodb+srv://rhzamora144:86e6FbGM00uV78RP@cluster0.4vwcokw.mongodb.net/reservas?retryWrites=true&w=majority&appName=Cluster0' --eval 'db.runCommand({ping: 1})'

Error: queryTxt ECONNREFUSED cluster0.4vwcokw.mongodb.net

[0;31m❌ CONEXIÓN FALLÓ con mongosh[0m

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PASO 3: Probar conexión con Node.js
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3.1: Ejecutando test de conexión con Node.js...
node:internal/modules/cjs/loader:1423
  throw err;
  ^

Error: Cannot find module 'mongoose'
Require stack:
- /private/tmp/test-mongodb-connection.js
    at Module._resolveFilename (node:internal/modules/cjs/loader:1420:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1058:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1063:22)
    at Module._load (node:internal/modules/cjs/loader:1226:37)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:244:24)
    at Module.require (node:internal/modules/cjs/loader:1503:12)
    at require (node:internal/modules/helpers:152:16)
    at Object.<anonymous> (/private/tmp/test-mongodb-connection.js:1:18)
    at Module._compile (node:internal/modules/cjs/loader:1760:14) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [ '/private/tmp/test-mongodb-connection.js' ]
}

Node.js v24.9.0

[0;31m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;31m❌ MongoDB Atlas NO está accesible[0m
[0;31m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[1;33mPOSIBLES SOLUCIONES:[0m

1️⃣ Verificar IP Whitelist en MongoDB Atlas:
   - Ir a: https://cloud.mongodb.com/v2
   - Network Access → IP Access List
   - Agregar: 0.0.0.0/0 (permite cualquier IP)

2️⃣ Verificar que el cluster esté activo:
   - Ir a: https://cloud.mongodb.com/v2
   - Database → Clusters
   - Estado debe ser: RUNNING (verde)

3️⃣ Verificar credenciales:
   - Usuario: rhzamora144
   - Contraseña: 86e6FbGM00uV78RP
   - Database: reservas

4️⃣ Regenerar URI de conexión:
   - Database → Connect
   - Connect your application
   - Copiar nueva URI

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
PASO 4: Probar configuraciones alternativas
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

4.1: Probar con timeout extendido (30s)...
node:internal/modules/cjs/loader:1423
  throw err;
  ^

Error: Cannot find module 'mongoose'
Require stack:
- /private/tmp/test-mongodb-timeout.js
    at Module._resolveFilename (node:internal/modules/cjs/loader:1420:15)
    at defaultResolveImpl (node:internal/modules/cjs/loader:1058:19)
    at resolveForCJSWithHooks (node:internal/modules/cjs/loader:1063:22)
    at Module._load (node:internal/modules/cjs/loader:1226:37)
    at TracingChannel.traceSync (node:diagnostics_channel:328:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:244:24)
    at Module.require (node:internal/modules/cjs/loader:1503:12)
    at require (node:internal/modules/helpers:152:16)
    at Object.<anonymous> (/private/tmp/test-mongodb-timeout.js:1:18)
    at Module._compile (node:internal/modules/cjs/loader:1760:14) {
  code: 'MODULE_NOT_FOUND',
  requireStack: [ '/private/tmp/test-mongodb-timeout.js' ]
}

Node.js v24.9.0

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 RESUMEN DEL DIAGNÓSTICO
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[0;31mEstado: MongoDB Atlas NO es accesible[0m

Acción requerida:
1. Verificar IP Whitelist (0.0.0.0/0)
2. Verificar que cluster esté RUNNING
3. Verificar credenciales
4. Contactar soporte de MongoDB Atlas si persiste

📋 Logs guardados en:
   - /tmp/mongosh-test.log
   - /tmp/node-mongo-test.log
