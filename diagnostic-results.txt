🔍 DIAGNÓSTICO EXHAUSTIVO DE MONGODB
=====================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 1: Leer horarios para HOY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Fecha: 09/30/2025
{"success":false,"error":"Error interno del servidor al obtener horarios ocupados","details":"Operation `bookedslots.find()` buffering timed out after 10000ms","bookedSlots":[],"slotsByDate":{}}
HTTP: 500 | Tiempo: 10.016705s

Resultado:
❌ FALLO - "error":"Error interno del servidor al obtener horarios ocupados"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 2: Leer horarios para fecha futura
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Fecha: 12/01/2025
{"success":false,"error":"Error interno del servidor al obtener horarios ocupados","details":"Operation `bookedslots.find()` buffering timed out after 10000ms","bookedSlots":[],"slotsByDate":{}}
HTTP: 500 | Tiempo: 10.005487s

Resultado:
❌ FALLO

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 3: Leer horarios en LOTE (batch)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Fechas: 10/01/2025,10/02/2025,10/03/2025
{"success":false,"error":"Error interno del servidor al obtener horarios en lote","details":"Operation `bookedslots.find()` buffering timed out after 10000ms","bookedSlots":{}}
HTTP: 500 | Tiempo: 10.004523s

Resultado:
❌ FALLO - Consulta batch falló

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 4: Estado detallado del sistema
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{"success":false,"error":"Error al verificar el estado del sistema","details":"Operation `bookings.countDocuments()` buffering timed out after 10000ms"}
HTTP: 500 | Tiempo: 10.006081s

Analizando respuesta del sistema...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 5: Crear reserva de prueba
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ID: diagnostic-test-1759234593
{"success":true,"bookingId":"diagnostic-test-1759234593","message":"Solicitud de reserva enviada - Emails notificados","status":"pending","emailsSent":true,"bookingSaved":false,"note":"Emails enviados correctamente. MongoDB no disponible temporalmente."}
HTTP: 201 | Tiempo: 31.495641s

Analizando resultado de creación...
✅ Reserva procesada
  ✅ Emails enviados
  ❌ NO guardado en MongoDB

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 6: Verificar persistencia
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Esperando 2 segundos...
{"success":false,"error":"Error interno del servidor al obtener horarios ocupados","details":"Operation `bookedslots.find()` buffering timed out after 10000ms","bookedSlots":[],"slotsByDate":{}}
HTTP: 500 | Tiempo: 10.003387s

❌ La reserva NO apareció en la consulta

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
TEST 7: Health check detallado
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
{"status":"error","mongodb":"disconnected","error":"Operation `bookings.countDocuments()` buffering timed out after 10000ms"}
HTTP: 500 | Tiempo: 10.003589s

❌ MongoDB reporta: DESCONECTADO

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 RESUMEN DEL DIAGNÓSTICO
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Resultados por test:
  Test 1 (Leer HOY):      ❌ FAIL
  Test 2 (Leer futuro):   ❌ FAIL
  Test 3 (Leer batch):    ❌ FAIL
  Test 4 (System status): ❌ FAIL
  Test 5 (Crear):         ✅ PASS
  Test 6 (Persistencia):  ❌ FAIL
  Test 7 (Health):        ✅ PASS

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Score: 2/7 tests pasaron
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
❌ MongoDB está FALLANDO (mayoría de tests fallaron)

📋 Archivos de diagnóstico guardados en /tmp/mongodb-test*.txt
🔍 Revisa los logs del servidor: tail -f server-diagnostic.log
